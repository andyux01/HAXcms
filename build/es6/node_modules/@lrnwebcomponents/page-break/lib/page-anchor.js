import{html as t,css as e}from"../../../lit/index.js";import{DDD as i}from"../../d-d-d/d-d-d.js";import{store as r}from"../../haxcms-elements/lib/core/haxcms-site-store.js";import{HAXStore as a}from"../../hax-body/lib/hax-store.js";import{toJS as s}from"../../../mobx/dist/mobx.esm.js";export class PageAnchor extends i{constructor(){super(),this.value=null,this.target=null,this.entityId=null}static get properties(){return{...super.properties,value:{type:String},target:{type:String},entityId:{type:String,attribute:"entity-id"}}}static get styles(){return[super.styles,e`
        :host {
          display: inline-block;
        }
        simple-icon-lite {
          margin-right: var(--ddd-spacing-2);
          --simple-icon-height: var(--ddd-icon-xxs);
          --simple-icon-width: var(--ddd-icon-xxs);
        }
      `]}clickHandler(t){if(console.log(t.type),this._haxState&&"click"===t.type)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;let e;e=this._haxState?globalThis.document.querySelector(".haxcms-theme-element "+this.target):a.activeHaxBody.querySelector(this.target),e&&(e.scrollIntoView(),setTimeout((()=>{switch(e.tagName.toLowerCase()){case"video-player":case"audio-player":this.value?e.seek(parseInt(this.value)):e.play();break;case"play-list":e.slide=parseInt(this.value)}}),100))}getMatchFromFields(t,e,i="color"){const o=s(r.entityData);if(o[t]&&o[t][i])return o[t][i];let l;if(l=this._haxState?globalThis.document.querySelector(".haxcms-theme-element "+e):a.activeHaxBody.querySelector(e),l&&e){let t=a.haxSchemaFromTag(l.tagName);if(t&&t.gizmo&&t.gizmo[i])return`--simple-colors-theme-default-${t.gizmo[i]}-3`}return null}render(){return t`<mark
      @click="${this.clickHandler}"
      style="background-color: var(${this.getMatchFromFields(this.entityId,this.target,"color")?`${this.getMatchFromFields(this.entityId,this.target,"color")}, `:""}initial)"
      >${this.getMatchFromFields(this.entityId,this.target,"icon")?t`<simple-icon-lite
            icon="${this.getMatchFromFields(this.entityId,this.target,"icon")}"
          ></simple-icon-lite>`:""}
      <slot></slot>
    </mark>`}static get tag(){return"page-anchor"}static get haxProperties(){return new URL(`./${this.tag}.haxProperties.json`,import.meta.url).href}haxHooks(){return{editModeChanged:"haxeditModeChanged",setupActiveElementForm:"haxsetupActiveElementForm"}}haxeditModeChanged(t){this._haxState=t}haxsetupActiveElementForm(t){var e=[{text:"-- No association --",value:null}];a.activeHaxBody.querySelectorAll("[id],[resource]").forEach((t=>{if(!["PAGE-BREAK","PAGE-ANCHOR","RICH-TEXT-EDITOR-HIGHLIGHT"].includes(t.tagName)){let i=a.haxSchemaFromTag(t.tagName),r=t.gizmo?t.gizmo.title:"",s=t.tagName.toLowerCase();i.gizmo&&i.gizmo.metadata&&i.gizmo.metadata.anchorLabel?r=t[i.gizmo.metadata.anchorLabel]:(""!=t.innerText&&(r=t.innerText),t.getAttribute("id")?(r+=` (${t.getAttribute("id")})`,s=`#${t.getAttribute("id")}`):t.getAttribute("resource")&&(r+=` (${t.getAttribute("resource")})`,s=`[resource="${t.getAttribute("resource")}"]`)),e.push({text:r,value:s})}}));const i=s(r.entityData);var o=[{text:"-- No association --",value:null}];Object.keys(i).map((t=>{o.push({text:i[t].title,value:i[t].id})})),t.settings.configure.forEach(((i,r)=>{"target"===i.property&&(t.settings.configure[r].inputMethod="select",t.settings.configure[r].itemsList=e),"entityId"===i.property&&(t.settings.configure[r].inputMethod="select",t.settings.configure[r].itemsList=o)}))}}globalThis.customElements.define(PageAnchor.tag,PageAnchor);