import{css as e,html as t,LitElement as n}from"../../../lit/index.js";import{DDDSuper as o}from"../../d-d-d/d-d-d.js";import{DDDDataAttributes as i,DDDPulseEffect as l}from"../../d-d-d/lib/DDDStyles.js";import"../video-player.js";import"../../simple-icon/lib/simple-icon-button-lite.js";import"../../simple-icon/lib/simple-icon-lite.js";import"../../simple-icon/lib/simple-icons.js";import"../../hax-iconset/lib/simple-hax-iconset.js";import"../../simple-modal/simple-modal.js";import"../../simple-cta/simple-cta.js";class LecturePlayer extends(o(n)){static get styles(){return[super.styles,i,l,e`
        :host {
          font-family: var(--ddd-font-primary, sans-serif);
        }

        @media (max-width: 1200px) {
          .videoSection {
            grid-template-columns: 1fr;
          }
        }
        lecture-player {
          width: 100%;
          height: 100%;
        }
      `]}constructor(){super(),this.associatedNodes=new Object,this.videoPlayer=this.querySelector("video-player").outerHTML,window.addEventListener("DOMContentLoaded",(()=>{this.querySelectorAll("lecture-anchor").forEach((e=>{console.log(e.associatedID),this.associatedNodes[e.value]=e.associatedID})),console.log(this.associatedNodes);for(const[e,t]of Object.entries(this.associatedNodes))console.log(`${e}: ${t}`)})),this.videoInterval=null,this.activeIndex=null}static get properties(){return{activeIndex:{type:String,reflect:!0},source:{type:String,reflect:!0},associatedNodes:{type:Object,reflect:!0},open:{type:Boolean,reflect:!0}}}updated(e){super.updated(e),e.forEach(((e,t)=>{"activeIndex"===t&&e!==this.activeIndex&&this.activeIndex&&(document.querySelector("video-player").playing||this.play,console.log("activeIndex changed to: ",this.activeIndex),console.log(document.querySelector("#"+this.activeIndex)),this.seek(this.querySelector("#"+this.activeIndex).value),this.updateJumbotron(),this.updatePlaylist(),this.checkDisabledButtons())}))}scan(){const e=this.querySelectorAll("lecture-anchor");console.log(e);const t=Array.from(e);t.sort(((e,t)=>parseInt(e.getAttribute("value"),10)-parseInt(t.getAttribute("value"),10))),t.forEach(((e,t)=>{e.id=`slide-${t+1}`,e.addEventListener("click",(()=>{this.activeIndex=e.id,this.seek(e.value),console.log(e.value)}))})),this.setJumbotronAttributes()}setJumbotronAttributes(){console.log("setJumbotronAttributes"),this.querySelectorAll("lecture-anchor").forEach((e=>{let t=this.querySelector(`#${e.getAttribute("associatedID")}`);e.setAttribute("jumbotronHeading",t.textContent),e.setAttribute("jumbotronContent",this.getNextSiblingHTML(t));let n=document.createElement("div");n.innerHTML=e.getAttribute("jumbotronContent"),n.querySelectorAll("lecture-anchor").forEach((e=>{e.removeAttribute("id"),e.classList.add("no-pointer-events")})),e.setAttribute("jumbotronContent",n.innerHTML)})),this.addPrevNextListeners(),this.updatePlaylist()}getNextSiblingHTML(e){let t="",n=e.nextSibling,o=Object.values(this.associatedNodes);for(;n&&(!n.id||!o.includes(n.id));)t+=n.outerHTML||"",n=n.nextSibling;return t}addPrevNextListeners(){console.log("addPrevNextListeners");const e=document.querySelector("#prevSlideBtn"),t=document.querySelector("#nextSlideBtn");this.activeIndex||(this.activeIndex="slide-1"),e.addEventListener("click",(()=>{const e=this.activeIndex.split("-")[1]>1?this.activeIndex.split("-")[1]-1:null;e&&(this.activeIndex="slide-"+e)})),t.addEventListener("click",(()=>{const e=document.querySelectorAll("lecture-anchor[id]").length;console.log(e),console.log(this.activeIndex.split("-")[1]),console.log(parseInt(this.activeIndex.split("-")[1])+1),console.log(parseInt(this.activeIndex.split("-")[1])+1<e);const t=this.activeIndex.split("-")[1]<e?parseInt(this.activeIndex.split("-")[1])+1:null;t?this.activeIndex="slide-"+t:this.endVideo()}))}updateJumbotron(){console.log("updateJumbotron");const e=document.querySelector(".jumbotron");console.log(e),e.innerHTML="";const t=document.querySelector(`#${this.activeIndex}`);if(console.log(t),t){const n=document.createElement("h2");n.id="jumbotron-heading",n.innerText=t.getAttribute("jumbotronHeading"),e.appendChild(n);const o=document.createElement("div");o.id="jumbotron-desc",o.innerHTML=t.getAttribute("jumbotronContent"),e.appendChild(o)}}updatePlaylist(){console.log("updatePlaylist");const e=document.querySelector(".valueList");e.innerHTML="";this.getSortedAnchors().forEach((t=>{const n=document.createElement("button");n.classList.add("valueBtn"),n.innerText=t.getAttribute("jumbotronHeading"),n.setAttribute("value",t.value),n.addEventListener("click",(()=>{this.activeIndex=t.id,this.seek(document.querySelector(`#${this.activeIndex}`).value)})),t.id===this.activeIndex&&n.classList.add("active"),e.appendChild(n)})),document.querySelector(".valueList").scrollTo({left:document.querySelector(".valueBtn.active").offsetLeft-125,behavior:"smooth"})}getSortedAnchors(){let e=[],t=1,n=document.querySelector(`#slide-${t}`);for(;n;)e.push(n),t++,n=document.querySelector(`#slide-${t}`);return e}seek(e){let t=document.querySelector("#lecture-player-video");t?t.hasAttribute("element-visible")?(document.querySelector("#lecture-player-video").shadowRoot.querySelector("a11y-media-player").play(),document.querySelector("#lecture-player-video").shadowRoot.querySelector("a11y-media-player").seek(e)):setTimeout((()=>{document.querySelector("#lecture-player-video").shadowRoot.querySelector("a11y-media-player").play(),document.querySelector("#lecture-player-video").shadowRoot.querySelector("a11y-media-player").seek(e)}),1e3):(this.querySelector("video-player").shadowRoot.querySelector("a11y-media-player").play(),this.querySelector("video-player").shadowRoot.querySelector("a11y-media-player").seek(e))}play(){console.log(document.querySelector("video-player").shadowRoot.querySelector("a11y-media-player")),document.querySelector("video-player").shadowRoot.querySelector("a11y-media-player")?document.querySelector("video-player").shadowRoot.querySelector("a11y-media-player").play():this.querySelector("video-player").shadowRoot.querySelector("a11y-media-player").play()}checkDisabledButtons(){console.log("checkDisabledButtons");const e=document.querySelector("#prevSlideBtn"),t=parseInt(this.activeIndex.split("-")[1]);1===t?e.setAttribute("disabled","true"):e.removeAttribute("disabled"),t!==document.querySelectorAll("lecture-anchor").length&&document.querySelector("#nextSlideBtn").removeAttribute("disabled")}endVideo(){console.log("endVideo"),document.querySelector("#lecture-player-video").shadowRoot.querySelector("a11y-media-player").pause(),document.querySelector("#nextSlideBtn").setAttribute("disabled","true");let e=document.createElement("div");e.setAttribute("data-primary","11"),e.innerHTML='<simple-cta class="endBtn" data-pulse data-primary="11">Close Lecture Player</simple-cta>',e.classList.add("endBtnContainer"),document.querySelector(".jumbotron").appendChild(e),document.querySelector(".endBtn").addEventListener("click",(()=>{document.querySelector("simple-modal").close(),this.open=!1}));let t=document.querySelector(".jumbotron");t.scrollTop=t.scrollHeight+500}showModal(e){console.log("showModal");let t=document.createElement("div");t.classList.add("modal-content"),t.innerHTML=`\n    <style>\n      simple-modal{\n        --simple-modal-width: 95%;\n        --simple-modal-height: 95%;\n        font-family: var(--ddd-font-primary, sans-serif);\n      }\n\n      .modal-content{\n        display: grid;\n        grid-template-rows: 1.5fr auto;\n        height: fit-content;\n        gap: var(--ddd-spacing-6);\n        padding: var(--ddd-spacing-4);\n      }\n\n      video-player{\n        max-width: 100%;\n        max-height: 100%;\n      }\n\n      .videoSection{\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        max-width: 100%;\n        height: 100%;\n        gap: var(--ddd-spacing-4);\n        max-height: 68vh;\n      }\n\n      .videoSection.small{\n        grid-template-columns: .7fr 1.3fr;\n      }\n\n      .videoSection.large{\n        grid-template-columns: 1.3fr .7fr;\n        height: 100%;\n        max-height: none;\n      }\n\n      .playlist{\n        display: grid;\n        grid-template-columns: .5fr 5fr .5fr;\n        gap: var(--ddd-spacing-2);\n        max-width: 100%;\n        height: fit-content;\n      }\n\n      .overflow-ellipsis{\n        max-width: 200px;\n        display: inline-block;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        word-wrap: break-word;\n        word-break: break-word;\n      }\n\n      .valueList {\n        display: flex; /* Use flexbox to layout items in a row */\n        flex-wrap: nowrap; /* Prevent wrapping of items */\n        border: var(--ddd-border-xs);\n        border-color: var(--ddd-theme-default-coalyGray, black);\n        background: #bab8b8;\n        overflow-x: auto; /* Enable horizontal scrolling */\n        overflow-y: hidden; /* Hide vertical overflow */\n      }\n      \n      .valueBtn {\n        flex-shrink: 0; /* Prevent buttons from shrinking */\n        background: white;\n        border: none;\n        border-right: 1px solid black; /* Keep the border-right */\n        cursor: pointer;\n        font-size: 24px;\n        padding: 16px; /* Add padding to space out the buttons */\n        height: 75px;\n        width: 200px;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        font-family: var(--ddd-font-primary, sans-serif);\n      }\n\n      .valueBtn:not(:last-child){\n        border-right: 1px solid black;\n      }\n\n      .jumbotron{\n        display: flex;\n        flex-direction: column;\n        justify-content: start;\n        align-items: start;\n        height: 100%;\n        overflow-y: auto;\n        overflow-x: show;\n      }\n\n      #jumbotron-heading{\n        padding: 8px;\n        width: calc(100% - 16px);\n        margin: 8px 0;\n      }\n\n      #jumbotron-desc{\n        padding: 8px;\n        width: calc(100% - 32px);\n      }\n\n      .value-navigation-button{\n        background: white;\n        cursor: pointer;\n        padding: 4px;\n        height: fit-content;\n        margin: auto;\n      }\n      \n      .valueBtn.active{\n        background: #dfedf5;\n      }\n\n      .endBtnContainer{\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n        height: 100%;\n        margin: 64px auto;\n      }\n\n      .lecture-control.active, .lecture-control:focus, .lecture-control:hover, .lecture-control:active{\n        color: var(--ddd-theme-default-beaverBlue, black);\n      }\n\n      .no-pointer-events{\n        pointer-events: none;\n      }\n      .lecture-mode-controls {\n        position: absolute;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        gap: var(--ddd-spacing-3);\n        padding: var(--ddd-spacing-2);\n        top: var(--ddd-spacing-2);\n        right: var(--ddd-spacing-20);\n      }\n      .lecture-mode-controls simple-icon-button-lite {\n        cursor: pointer;\n        --simple-icon-height: var(--ddd-icon-xs);\n        --simple-icon-width: var(--ddd-icon-xs);\n      }\n      @media (max-width: 1200px) {\n        .videoSection {\n          display: flex;\n          flex-direction: column;\n        }\n      }\n    </style>\n      <div class="videoSection normal">\n          ${this.videoPlayer}\n        <div class="jumbotron"></div>\n        <div class="lecture-mode-controls">\n        <simple-icon-button-lite class="lecture-control" id="lecture-size-small" icon="image:photo-size-select-large"></simple-icon-button-lite>\n        <simple-icon-button-lite class="lecture-control" id="lecture-size-normal" icon="image:switch-video"></simple-icon-button-lite>\n        <simple-icon-button-lite class="lecture-control" id="lecture-size-large" icon="image:photo-size-select-actual"></simple-icon-button-lite>\n      </div>\n      </div>\n      <div class="playlist">\n        <button class="value-navigation-button" id="prevSlideBtn"><simple-icon-lite icon="lrn:arrow-left"></simple-icon-lite></button>\n        <div class="valueList">\n        </div>\n        <button class="value-navigation-button" id="nextSlideBtn"><simple-icon-lite icon="lrn:arrow-right"></simple-icon-lite></button>\n      </div>\n    `,this.querySelector("video-player").setAttribute("hidden",!0);const n=new CustomEvent("simple-modal-show",{bubbles:!0,cancelable:!0,detail:{elements:{content:t}}});this.open=!0,dispatchEvent(n),document.querySelector("#lecture-size-large").addEventListener("click",(e=>{document.querySelectorAll(".lecture-control").forEach((e=>{e.classList.remove("active")})),e.target.classList.toggle("active"),document.querySelector(".videoSection").classList.add("large"),document.querySelector(".videoSection").classList.remove("small"),document.querySelector(".videoSection").classList.remove("normal")})),document.querySelector("#lecture-size-normal").addEventListener("click",(e=>{document.querySelectorAll(".lecture-control").forEach((e=>{e.classList.remove("active")})),e.target.classList.toggle("active"),document.querySelector(".videoSection").classList.add("normal"),document.querySelector(".videoSection").classList.remove("small"),document.querySelector(".videoSection").classList.remove("large")})),document.querySelector("#lecture-size-small").addEventListener("click",(e=>{document.querySelectorAll(".lecture-control").forEach((e=>{e.classList.remove("active")})),e.target.classList.toggle("active"),document.querySelector(".videoSection").classList.add("small"),document.querySelector(".videoSection").classList.remove("normal"),document.querySelector(".videoSection").classList.remove("large")})),document.querySelector("simple-modal .modal-content .videoSection video-player").setAttribute("id","lecture-player-video"),this.scan(),window.addEventListener("simple-modal-closed",(()=>{this.querySelector("video-player").removeAttribute("hidden"),this.open=!1}))}render(){return t`
      <simple-cta id="lectureActivation" @click="${this.showModal}"
        >Open Lecture Player</simple-cta
      >
      ${this.open?t``:t`<slot></slot>`}
    `}}window.customElements.define("lecture-player",LecturePlayer);