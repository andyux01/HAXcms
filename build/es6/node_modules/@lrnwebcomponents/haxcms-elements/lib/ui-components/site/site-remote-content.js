/**
 * Copyright 2022 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import{LitElement as e,html as m,css as t}from"../../../../../lit/index.js";import{store as r}from"../../core/haxcms-site-store.js";import{HAXCMSI18NMixin as a}from"../../core/utils/HAXCMSI18NMixin.js";import{wipeSlot as o,lightChildrenToShadowRootSelector as i,unwrap as n,encapScript as s}from"../../../../utils/utils.js";import{enableServices as g}from"../../../../micro-frontend-registry/lib/microServices.js";import{MicroFrontendRegistry as b}from"../../../../micro-frontend-registry/micro-frontend-registry.js";g(["haxcms"]);class SiteRemoteContent extends(a(e)){static get styles(){return[t`
        :host {
          display: inline;
        }
        :host([loading]) .loading {
          margin: 8px 0 0 -12px;
          font-size: 2px;
          width: 4px;
          height: 4px;
          border-radius: 50%;
          position: absolute;
          -webkit-animation: load5 1.1s infinite ease;
          animation: load5 1.1s infinite ease;
          -webkit-transform: translateZ(0);
          -ms-transform: translateZ(0);
          transform: translateZ(0);
        }
        @-webkit-keyframes load5 {
          0%,
          100% {
            box-shadow: 0em -2.6em 0em 0em var(--enhanced-text-color, #000000),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.5),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.7);
          }
          12.5% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.7),
              1.8em -1.8em 0 0em var(--enhanced-text-color, #000000),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.5);
          }
          25% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.5),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.7),
              2.5em 0em 0 0em var(--enhanced-text-color, #000000),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          37.5% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.5),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.7),
              1.75em 1.75em 0 0em var(--enhanced-text-color, #000000),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          50% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.5),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.7),
              0em 2.5em 0 0em var(--enhanced-text-color, #000000),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          62.5% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.5),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.7),
              -1.8em 1.8em 0 0em var(--enhanced-text-color, #000000),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          75% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.5),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.7),
              -2.6em 0em 0 0em var(--enhanced-text-color, #000000),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          87.5% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.5),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.7),
              -1.8em -1.8em 0 0em var(--enhanced-text-color, #000000);
          }
        }
        @keyframes load5 {
          0%,
          100% {
            box-shadow: 0em -2.6em 0em 0em var(--enhanced-text-color, #000000),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.5),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.7);
          }
          12.5% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.7),
              1.8em -1.8em 0 0em var(--enhanced-text-color, #000000),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.5);
          }
          25% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.5),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.7),
              2.5em 0em 0 0em var(--enhanced-text-color, #000000),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          37.5% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.5),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.7),
              1.75em 1.75em 0 0em var(--enhanced-text-color, #000000),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          50% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.5),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.7),
              0em 2.5em 0 0em var(--enhanced-text-color, #000000),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.2),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          62.5% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.5),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.7),
              -1.8em 1.8em 0 0em var(--enhanced-text-color, #000000),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          75% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.5),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.7),
              -2.6em 0em 0 0em var(--enhanced-text-color, #000000),
              -1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2);
          }
          87.5% {
            box-shadow: 0em -2.6em 0em 0em rgba(255, 255, 255, 0.2),
              1.8em -1.8em 0 0em rgba(255, 255, 255, 0.2),
              2.5em 0em 0 0em rgba(255, 255, 255, 0.2),
              1.75em 1.75em 0 0em rgba(255, 255, 255, 0.2),
              0em 2.5em 0 0em rgba(255, 255, 255, 0.2),
              -1.8em 1.8em 0 0em rgba(255, 255, 255, 0.5),
              -2.6em 0em 0 0em rgba(255, 255, 255, 0.7),
              -1.8em -1.8em 0 0em var(--enhanced-text-color, #000000);
          }
        }
      `]}static get tag(){return"site-remote-content"}constructor(){super(),this.loading=!1,this.uuid=null,this.siteurl="https://haxtheweb.org/",this.showTitle=!1,this.breakreference=!1,this._remoteTitle=null,this.t={selectPage:"Select page"}}render(){return m`
    <div class="loading"></div>
    ${this.showTitle&&this._remoteTitle?m`<h3>${this._remoteTitle}</h3>`:""}
    <div id="content"></div>
    `}updated(e){super.updated&&super.updated(e),e.forEach(((e,m)=>{"uuid"===m&&this[m]&&(this.loading=!0,b.call("@haxcms/pageCache",{site:this.siteurl,type:"link",uuid:this.uuid,data:!0},this.renderContentResponse.bind(this))),"siteurl"===m&&window.HaxStore&&(clearTimeout(this.__debounce),this.__debounce=setTimeout((()=>{this.loading=!0,window.HaxStore.instance.refreshActiveNodeForm()}),500)),"breakreference"===m&&this[m]&&(this.loading=!0,b.call("@haxcms/pageCache",{site:this.siteurl,type:"link",uuid:this.uuid,data:!0},this.renderContentResponse.bind(this)))}))}renderContentResponse(e){if(e.data){window.HaxStore&&!this.breakreference&&window.HaxStore.instance.activeBodyIgnoreActive(!0);const m=this.shadowRoot.querySelector("#content");o(m);let t=document.createElement("div");t.innerHTML=s(e.data.content),this.appendChild(t),n(t),this._remoteTitle=e.data.title,this.loading=!1,this.breakreference?n(this):i(this,"#content")}}static get properties(){return{...super.properties,uuid:{type:String},siteurl:{type:String},showTitle:{type:Boolean,attribute:"show-title"},_remoteTitle:{type:String},loading:{type:Boolean,reflect:!0},breakreference:{type:Boolean}}}firstUpdated(e){if(super.firstUpdated(e),this.children.length>0){let e=this.shadowRoot.querySelector("#content");o(e),i(this,"#content")}}static get haxProperties(){return{canScale:!1,canPosition:!1,canEditSource:!1,gizmo:{title:"Site Content",description:"Reuse content from one site in another.",icon:"hax:remote",color:"grey",groups:["Content","CMS"],handles:[],meta:{author:"HAXTheWeb core team"}},settings:{configure:[{property:"siteurl",title:"Site address",description:"Paste address to reference content from if not the current site",inputMethod:"textfield"},{property:"uuid",title:"Item",description:"Item to render for the link / title data",inputMethod:"textfield"},{property:"showTitle",title:"Show title",description:"Toggle on to render the title of the resource being displayed",inputMethod:"boolean"}],advanced:[{property:"breakreference",title:"Break reference",description:"Checking this box copies the remote content for editing locally but removes the association. It will no longer get updates when the reference material updates.",inputMethod:"boolean"}]},demoSchema:[{tag:"site-remote-content",properties:{showTitle:!0,_remoteTitle:"Select content"},content:"<div>Remote rendered material</div>"}],saveOptions:{unsetAttributes:["t","_remote-title"]}}}haxHooks(){return{progressiveEnhancement:"haxprogressiveEnhancement",setupActiveElementForm:"haxsetupActiveElementForm"}}haxprogressiveEnhancement(e){return this.shadowRoot.querySelector("#content").innerHTML}async haxsetupActiveElementForm(e){if(window.HAXCMS){let t=[];if(this.siteurl){const e=await b.call("@haxcms/siteManifest",{site:this.siteurl});e.data&&e.data.items&&(t=e.data.items)}else t=r.getManifestItems(!0);var m=[{text:this.t.selectPage,value:null}];t.forEach((e=>{if(e.id!=this.itemId){let r=e,a="- ";for(;r&&null!=r.parent;)r=t.find((e=>e.id==r.parent)),r&&(a="--"+a);m.push({text:a+e.title,value:e.id})}})),e.settings.configure.forEach(((t,r)=>{"uuid"===t.property&&(e.settings.configure[r].inputMethod="select",e.settings.configure[r].itemsList=m)})),this.loading=!1}}}customElements.define(SiteRemoteContent.tag,SiteRemoteContent);export{SiteRemoteContent};