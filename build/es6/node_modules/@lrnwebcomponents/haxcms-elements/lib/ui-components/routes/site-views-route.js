/**
 * Copyright 2022 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import{LitElement as t,html as e,css as s}from"../../../../../lit/index.js";import{store as i}from"../../core/haxcms-site-store.js";import{MicroFrontendRegistry as a}from"../../../../micro-frontend-registry/micro-frontend-registry.js";import{enableServices as o}from"../../../../micro-frontend-registry/lib/microServices.js";import"../../../../simple-fields/lib/simple-tags.js";import{autorun as r,toJS as n}from"../../../../../mobx/dist/mobx.esm.js";export class SiteViewsRoute extends t{static get tag(){return"site-views-route"}static get styles(){return[s`
        :host {
          display: block;
        }
        a {
          text-decoration: none;
        }
    `]}constructor(){super(),this.loading=!1,this.results=[],this._debounce=null,o(["haxcms"]),r((()=>{i.currentRouterLocation;clearTimeout(this._debounce),this._debounce=setTimeout((async()=>{if(!this.loading&&"views"===i.getInternalRoute()){const t=Object.fromEntries(new URLSearchParams(location.search)),e=n(i.manifest);let s=document.querySelector("base").href;s||(s="/");const o={type:"site",site:{file:s+"site.json",id:e.id,title:e.title,author:e.author,description:e.description,license:e.license,metadata:e.metadata,items:e.items},link:s,...t};this.loading=!0;const r=await a.call("@haxcms/views",o);r.data&&(this.results=r.data),this.loading=!1}}),0)}))}render(){return e`
      ${this.loading?e`<h3>Loading...</h3>`:e`<h3>Results</h3>
${this.results.map((t=>e`
        <div>
          <a href="${t.slug}">${t.title}</a>
          ${t.metadata.tags&&""!=t.metadata.tags?t.metadata.tags.split(",").map((s=>e`<a href="x/views?tag=${s.trim()}">
            <simple-tag
              auto-accent-color
              value="${s.trim()}"
              accent-color="${t.accentColor}"
            ></simple-tag></a>`)):""}
        </div>
      `))}`}
      <slot></slot>
    `}activateView(t){const e=new URLSearchParams(window.location.search);e.set("tag",t.target.value),window.history.pushState({},"",decodeURIComponent(`./x/views?${e}`))}static get properties(){return{results:{type:Array},loading:{type:Boolean,reflect:!0}}}}customElements.define(SiteViewsRoute.tag,SiteViewsRoute);