import{store as i}from"./haxcms-site-store.js";import{toJS as t}from"../../../../mobx/dist/mobx.esm.js";import{LitElement as e,html as s,css as o}from"../../../../lit/index.js";import{HAXCMSI18NMixin as a}from"./utils/HAXCMSI18NMixin.js";import{MicroFrontendRegistry as r}from"../../../micro-frontend-registry/micro-frontend-registry.js";import{enableServices as l}from"../../../micro-frontend-registry/lib/microServices.js";import"../../../simple-tooltip/simple-tooltip.js";import"../../../a11y-tabs/a11y-tabs.js";import"../../../../@github/time-elements/dist/relative-time-element.js";import"../../../iframe-loader/lib/loading-indicator.js";l(["haxcms"]);class HAXCMSShareDialog extends(a(e)){static get styles(){return[o`
        :host {
          display: block;
          overflow: auto;
        }
      `]}firstUpdated(i){super.firstUpdated(i),this.refreshData()}_insightResponse(i){this.loading=!1,this.data=i.data}refreshData(){var e="";document.querySelector("base")&&(e=document.querySelector("base").href);const s=t(i.manifest),o=t(i.ancestorItem),a={type:"site",site:{file:e+"site.json",id:s.id,title:s.title,author:s.author,description:s.description,license:s.license,metadata:s.metadata,items:s.items},activeId:t(i.activeId),ancestorId:o?o.id:null,link:e};this.loading=!0,r.call("@haxcms/insights",a,this._insightResponse.bind(this),this)}static get tag(){return"haxcms-site-insights"}getReadingTime(i){let t=[];var e=Math.floor(i/60),s=Math.floor(i-60*e);return 1===e?t.push(`${e} ${this.t.hour}`):0===e||t.push(`${e} ${this.t.hours}`),1===s?t.push(`${s} ${this.t.minute}`):0===s||t.push(`${s} ${this.t.minutes}`),t.join(", ")}closeModal(){window.dispatchEvent(new CustomEvent("simple-modal-hide"))}render(){const i=this.data.site,t=this.data.branch,e=this.data.page;return s`
    <simple-icon-button-lite @click="${this.refreshData}" icon="refresh" ?disabled="${this.loading}">${this.t.refresh}</simple-icon-button-lite>
    <a11y-tabs id="tabs" full-width>
      <a11y-tab id="course" icon="communication:import-contacts" label="${this.t.course}">
      <loading-indicator full ?loading="${this.loading}"></loading-indicator>
      ${this.loading?s`<p>${this.t.loading}...</p>`:s`
        <div>
          <h2>Course insights</h2>
          <ul>
            <li><strong>${i.objectives}</strong> ${0==i.objectives?s`objectives, why not add some?`:s`objectives in this course`}</li>
            <li><strong>${i.specialTags}</strong> special elements</li>
            <li><strong>${i.headings}</strong> headings</li>
            <li><strong>${i.links}</strong> links</li>
            ${0==i.video?"":s`<li><strong>${i.video}</strong> videos ${0!=i.videoLength?s`(<strong>${toHHMMSS(i.videoLength)}</strong>)`:""}</li>`}
            <li><strong>${i.pages}</strong> Pages</li>
            <li><strong>${this.getReadingTime(i.readTime)}</strong> of reading</li>
            <li><strong>${i.readability.gradeLevel}</strong> grade reading level</li>
            <li><strong>${i.readability.lexiconCount}</strong> words</li>
            <li><strong>${i.readability.difficultWords}</strong> difficult words</li>
            <li>Created:
              <relative-time datetime="${i.created}">
              </relative-time></li>
            <li>Last updated:
              <relative-time datetime="${i.updated}">
              </relative-time></li>
            <li>Recent updates:
              <ol>
                ${i.updatedItems.map((i=>s`
                <li>
                  <a @click="${this.closeModal}" href="${i.slug}">${i.title} <relative-time datetime="${i.metadata.updated}"></relative-time></a>
                </li>`))}
              </ol>
            </li>
          </ul>
        </div>
      `}
      </a11y-tab>
      <a11y-tab id="lesson" icon="editor:format-list-bulleted" label="${this.t.lesson}">
        <loading-indicator full ?loading="${this.loading}"></loading-indicator>
        <div>
        ${this.loading?s`<p>${this.t.loading}...</p>`:s`
        <h2>Lesson insights</h2>
          <ul>
            ${0==t.video?"":s`<li><strong>${t.video}</strong> videos ${0!=t.videoLength?s`(<strong>${toHHMMSS(t.videoLength)}</strong>)`:""}</li>`}
            <li><strong>${t.objectives}</strong> ${0==t.objectives?s`objectives, why not add some?`:s`objectives in this course`}</li>
            <li><strong>${t.specialTags}</strong> special elements</li>
            <li><strong>${t.headings}</strong> headings</li>
            <li><strong>${t.links}</strong> links</li>
                <li><strong>${t.pages}</strong> Pages</li>
                <li><strong>${this.getReadingTime(t.readTime)}</strong> of reading</li>
                <li><strong>${t.readability.gradeLevel}</strong> grade reading level</li>
                <li><strong>${t.readability.lexiconCount}</strong> words</li>
                <li><strong>${t.readability.difficultWords}</strong> difficult words</li>
            <li>Created:
              <relative-time datetime="${t.created}">
              </relative-time>
            </li>
            <li>Last updated:
              <relative-time datetime="${t.updated}">
              </relative-time>
            </li>
          </ul>
          `}
        </div>
      </a11y-tab>
      <a11y-tab id="page" icon="icons:subject" label="${this.t.page}">
        <div>
        <loading-indicator full ?loading="${this.loading}"></loading-indicator>
        ${this.loading?s`<p>${this.t.loading}...</p>`:s`
            <h2>Page insights</h2>
            <ul>
              ${0==e.objectives?"":s`<li><strong>${e.objectives}</strong> objectives</li>`}
              ${0==e.video?"":s`<li><strong>${e.video}</strong> videos ${0!=e.videoLength?s`(<strong>${toHHMMSS(e.videoLength)}</strong>)`:""}</li>`}
              <li><strong>${e.specialTags}</strong> special elements</li>
              <li><strong>${e.headings}</strong> headings</li>
              <li><strong>${e.links}</strong> links</li>
              <li><strong>${e.pages}</strong> Pages</li>
              <li><strong>${this.getReadingTime(e.readTime)}</strong> of reading</li>
              <li><strong>${e.readability.gradeLevel}</strong> grade reading level</li>
              <li><strong>${e.readability.lexiconCount}</strong> words</li>
              <li><strong>${e.readability.difficultWords}</strong> difficult words</li>
              <li>Created:
                <relative-time datetime="${e.created}">
                </relative-time></li>
              <li>Last updated:
                <relative-time datetime="${e.updated}">
                </relative-time></li>
            </ul>
          `}
          </div>
        </a11y-tab>
      </a11y-tabs>
    `}constructor(){super(),this.t=this.t||{},this.t={...this.t,refresh:"Refresh",loading:"Loading",course:"Course",lesson:"Lesson",page:"Page",hour:"hour",hours:"hours",minute:"minute",minutes:"minutes"},this.data={site:{readability:{},updatedItems:[]},branch:{readability:{}},page:{readability:{}}},this.loading=!1}static get properties(){return{...super.properties,data:{type:Object},loading:{type:Boolean,reflect:!0}}}}window.customElements.define(HAXCMSShareDialog.tag,HAXCMSShareDialog);export{HAXCMSShareDialog};function toHHMMSS(i){var t="",e=parseInt(i,10),s=Math.floor(e/3600),o=Math.floor((e-3600*s)/60);return 0!==s&&(t+=`${s} hour`,1!==s&&(t+="s"),t+=", "),0!==o&&(t+=`${o} minute`,1!==s&&(t+="s")),t}