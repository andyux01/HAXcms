/**
 * Copyright 2019 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import{HAXStore as n}from"../hax-body/lib/hax-store.js";import"./lib/h-a-x-dependencies.js";import{localStorageGet as e}from"../utils/utils.js";import{editableTableDisplayStyles as t}from"../editable-table/lib/editable-table-behaviors.js";import{SimpleIconsetStore as a}from"../simple-icon/lib/simple-iconset.js";import{learningComponentColors as i,iconFromPageType as o}from"../course-design/lib/learning-component.js";class HAX extends HTMLElement{get html(){let n=["red","blue","green","orange","purple"].map((n=>`\n        [data-style-decoration~="highlight"] {\n          color: var(--haxcms-style-element-color, white);\n          background-color: var(--haxcms-style-element-background-color, black);\n          font-weight: 400;\n          word-wrap: break-word;\n          padding: 4px 8px;\n          text-transform: uppercase;\n          text-decoration: none;\n        }\n        [data-style-decoration~="${n}"] {\n          --haxcms-style-element-background-color: var(--simple-colors-default-theme-${n}-7, ${n});\n        }\n        `)),e=Object.keys(i).map((n=>{let e=i[n];return`\n        h1[data-instructional-action="${n}"],\n        h2[data-instructional-action="${n}"],\n        h3[data-instructional-action="${n}"],\n        h4[data-instructional-action="${n}"],\n        h5[data-instructional-action="${n}"],\n        h6[data-instructional-action="${n}"] {\n          --hax-action-color: var(--simple-colors-default-theme-${e}-8, ${e});\n          --hax-action-line-color: var(--simple-colors-default-theme-${e}-8, ${e});\n          --hax-action-accent-color: #eeeeee;\n          --hax-action-border: var(--simple-colors-default-theme-${e}-8, ${e}) solid 3px;\n        }\n        h1[data-instructional-action="${n}"]::after,\n        h2[data-instructional-action="${n}"]::after,\n        h3[data-instructional-action="${n}"]::after,\n        h4[data-instructional-action="${n}"]::after,\n        h5[data-instructional-action="${n}"]::after,\n        h6[data-instructional-action="${n}"]::after {\n          -webkit-mask-image: url("${a.getIcon(o(n))}");\n        }\n        \n        hr[data-instructional-action="${n}"] {\n          --hax-action-color: var(--simple-colors-default-theme-${e}-8, ${e});\n          --hax-action-line-color: var(--simple-colors-default-theme-${e}-8, ${e});\n          --hax-action-accent-color: #eeeeee;\n          --hax-action-border: var(--simple-colors-default-theme-${e}-8, ${e}) solid 3px;\n        }\n        \n        hr[data-instructional-action="${n}"]::after {\n          -webkit-mask-image: url("${a.getIcon(o(n))}");\n        }\n        `}));return`\n    <style>\n    ${n.join("\n")}\n    ${e.join("\n")}\n    ${t.map((n=>n.cssText.replace(/:host/g,"hax-body table"))).join(" ")}\n    hr[data-instructional-action] {\n      border: none;\n      border-top: 2px dashed var(--hax-action-line-color, blue);\n      overflow: visible;\n      text-align: center;\n      height: 4px;\n      padding: 0px;\n      background-color: white;\n    }\n    \n    hr[data-instructional-action]::before {\n      background-color: var(--hax-action-accent-color, #aaa);\n      height: 50px;\n      width: 50px;\n      margin: 0 auto;\n      background-position: center;\n      content: '';\n      display: block;\n      top: -28px;\n      position: relative;\n      z-index: 1;\n      border: var(--hax-action-border ,2px solid blue);\n      border-radius: 50%;\n    }\n  \n    hr[data-instructional-action]::after {\n      content: '';\n      position: relative;\n      z-index: 2;\n      background-color: var(--hax-action-color, blue);\n      mask-repeat: no-repeat;\n      mask-size: contain;\n      -webkit-mask-repeat: no-repeat;\n      -webkit-mask-size: contain;\n      padding: 18px;\n      top: -64px;\n    }\n    h1[data-instructional-action],\n    h2[data-instructional-action],\n    h3[data-instructional-action],\n    h4[data-instructional-action],\n    h5[data-instructional-action],    \n    h6[data-instructional-action] {\n      padding-left: 72px;\n    }\n    h1[data-instructional-action]::before,\n    h2[data-instructional-action]::before,\n    h3[data-instructional-action]::before,\n    h4[data-instructional-action]::before,\n    h5[data-instructional-action]::before,    \n    h6[data-instructional-action]::before {\n      background-color: var(--hax-action-accent-color, #aaa);\n      height: 50px;\n      width: 50px;\n      background-position: center;\n      content: '';\n      display: block;\n      position: absolute;\n      z-index: 1;\n      border: var(--hax-action-border , 3px solid black);\n      border-radius: 50%;\n      left: 0px;\n      margin: 4px;\n    }\n    h1[data-instructional-action]::after,\n    h2[data-instructional-action]::after,\n    h3[data-instructional-action]::after,\n    h4[data-instructional-action]::after,\n    h5[data-instructional-action]::after,    \n    h6[data-instructional-action]::after {\n      content: '';\n      position: relative;\n      z-index: 2;\n      background-color: var(--hax-action-color, blue);\n      mask-repeat: no-repeat;\n      mask-size: contain;\n      -webkit-mask-repeat: no-repeat;\n      -webkit-mask-size: contain;\n      padding: 22px;\n      margin: 10px;\n      position: absolute;\n      left: 0px;\n    }\n    [data-instructional-action][data-id-emphasize] {\n      background-color: var(--hax-action-color) !important;\n      color: white;\n    }\n\n    :host,h-a-x {\n      display: block;\n      font-size: var(--haxcms-base-styles-body-font-size);\n      font-family: var(--haxcms-base-styles-body-font-family);\n      line-height: var(--haxcms-base-styles-body-line-height);\n      letter-spacing: var(--haxcms-base-styles-body-letter-spacing);\n    }\n\n    :host([hidden]),h-a-x([hidden]) {\n      display: none;\n    }\n\n    :host hax-body, h-a-x hax-body {\n      font-size: var(--haxcms-base-styles-body-font-size);\n      font-family: var(--haxcms-base-styles-body-font-family);\n      line-height: var(--haxcms-base-styles-body-line-height);\n      letter-spacing: var(--haxcms-base-styles-body-letter-spacing);\n    }\n\n    :host img, h-a-x img {\n      max-width: 100%;\n      max-width: -moz-available;\n      max-width: -webkit-fill-available;\n      max-width: fill-available;\n    }\n\n    hax-body h1 {\n      font-size: var(--hax-base-styles-h1-font-size);\n      line-height: var(--hax-base-styles-h1-line-height);\n    }\n\n    hax-body h2 {\n      font-size: var(--hax-base-styles-h2-font-size);\n    }\n\n    hax-body h3 {\n      font-size: var(--hax-base-styles-h3-font-size);\n    }\n\n    hax-body h4 {\n      font-size: var(--hax-base-styles-h4-font-size);\n    }\n\n    hax-body h5 {\n      font-size: var(--hax-base-styles-h5-font-size);  \n    }\n\n    hax-body h6 {\n      font-size: var(--hax-base-styles-h6-font-size);\n    }\n\n    hax-body p {\n      min-height: var(--hax-base-styles-p-min-height);\n      font-size: var(--hax-base-styles-p-font-size);\n      line-height: var(--hax-base-styles-p-line-height);\n      letter-spacing: var(--hax-base-styles-p-letter-spacing);\n    }\n    hax-body p code {\n      padding: 0.2em 0.4em;\n      margin: 0;\n      font-size: 12px;\n      background-color: var(--hax-base-styles-code-background-color,rgba(175, 184, 193, 0.2));\n      border-radius: 6px;\n      font-family: var(--hax-base-styles-code-font-family, ui-monospace,monospace);\n    }\n    hax-body pre {\n      padding: 16px;\n      overflow: auto;\n      line-height: 1.45;\n      background-color: var(--hax-base-styles-pre-background-color,rgba(175, 184, 193, 0.2));\n      border-radius: 6px;\n      margin-bottom: 0;\n      word-break: normal;\n      word-wrap: normal;\n      margin-top: 0;\n      font-family: var(--hax-base-styles-pre-font-family, ui-monospace,monospace);\n      font-size: 12px;\n    }\n\n    hax-body a,\n    hax-body a:-webkit-any-link,\n    hax-body a,\n    hax-body a:-webkit-any-link    {\n      font-size: var(--hax-base-styles-a-font-size,var(--hax-base-styles-p-font-size));\n    }\n\n    hax-body ol,\n    hax-body ul\n    hax-body ol li,\n    hax-body ul li,\n    hax-body li {\n      line-height: var(--hax-base-styles-list-line-height,var(--hax-base-styles-p-line-height));\n      font-size: var(--hax-base-styles-list-font-size,var(--hax-base-styles-p-font-size));\n    }\n\n    hax-body  ul,\n    hax-body  ul ol,\n    hax-body  ol ul,\n    hax-body  ol ol {\n      padding-bottom: unset;\n    }\n    hax-body table {\n      min-width: 300px;\n      border-collapse: collapse;\n      margin: 0 0 15px;\n      display: table!important;\n    }\n    hax-body table caption,\n    hax-body table th,\n    hax-body table td {\n      border: 1px solid #888;\n      padding: 5px 10px;\n      text-align: left;\n      vertical-align: middle;\n    }\n    \n    hax-body[edit-mode] [data-hax-active][contenteditable] {\n      outline-offset: 8px;\n      outline: var(--hax-body-active-outline, 2px solid var(--hax-ui-color-focus, #000)) !important;\n      caret-color: var(--hax-ui-caret-color, auto);\n    }\n    figure {\n      margin-left: 0;\n      margin-right: 0;\n    }\n    figure > *:first-child, \n    figcaption > *:first-child{\n      margin-top: 0;\n    }\n    figure > *:last-child.\n    figcaption > *:last-child {\n      margin-bottom: 0;\n    }\n    </style>\n    <hax-body>\n        <slot></slot>\n    </hax-body>`}static get tag(){return"h-a-x"}constructor(n=!1){super(),this.__rendered=!1,this.tag=HAX.tag,this.template=document.createElement("template"),this.attachShadow({mode:"open"}),n||this.render(),window.addEventListener("hax-store-ready",this.storeReady.bind(this),{once:!0,passive:!0}),window.addEventListener("hax-store-app-store-loaded",this.appStoreReady.bind(this),{once:!0,passive:!0}),window.addEventListener("hax-cancel",this.cancelEvent.bind(this)),window.addEventListener("hax-save",this.saveEvent.bind(this))}cancelEvent(n){this.importSlotToHaxBody()}async saveEvent(e){const t=await n.activeHaxBody.haxToContent();this.innerHTML=t,this.dispatchEvent(new CustomEvent("hax-save-body-value",{composed:!0,bubbles:!0,cancelable:!0,detail:{value:t}}))}connectedCallback(){super.connectedCallback&&super.connectedCallback(),this.__HAXApplied||window.__HAXApplied||(window.__HAXApplied=this.__HAXApplied=this.applyHAX())}storeReady(e){e.detail&&(setTimeout((()=>{try{let e={...JSON.parse(this.getAttribute("app-store"))};"object"==typeof e&&(n.appStore=e)}catch(n){console.warn(n)}"hide-panel-ops"===this.hidePanelOps&&(this.hidePanelOps=!0),n.haxTray.hidePanelOps=this.hidePanelOps,n.haxTray.offsetMargin=this.offsetMargin,n.elementAlign=this.elementAlign}),0),window.removeEventListener("hax-store-ready",this.storeReady.bind(this),{once:!0,passive:!0}))}importSlotToHaxBody(){var e=[];e=this.shadowRoot.querySelector("slot")?this.shadowRoot.querySelector("slot").assignedNodes():this.children;let t="";for(let n in e)void 0!==e[n].outerHTML&&(t+=e[n].outerHTML);n.activeHaxBody.importContent(t)}appStoreReady(n){n.detail&&(this.importSlotToHaxBody(),window.removeEventListener("hax-store-app-store-loaded",this.appStoreReady.bind(this),{once:!0,passive:!0}))}render(){this.__rendered=!0,this.shadowRoot.innerHTML=null,this.template.innerHTML=this.html,this.shadowRoot.appendChild(this.template.content.cloneNode(!0))}applyHAX(){let n=window.HaxStore.requestAvailability(),t=document.createElement("hax-tray");return t.hidePanelOps=this.hidePanelOps,this.elementAlign=e("hax-tray-elementAlign"),this.elementAlign&&null!=this.elementAlign&&""!=this.elementAlign||(this.elementAlign="left"),n.elementAlign=this.elementAlign,document.body.appendChild(t),document.body.appendChild(document.createElement("hax-app-picker")),document.body.appendChild(document.createElement("hax-autoloader")),document.body.appendChild(document.createElement("hax-cancel-dialog")),!0}disconnectedCallback(){window.removeEventListener("hax-store-ready",this.storeReady.bind(this),{once:!0,passive:!0}),window.removeEventListener("hax-store-app-store-loaded",this.appStoreReady.bind(this),{once:!0,passive:!0}),window.removeEventListener("hax-cancel",this.cancelEvent.bind(this)),window.removeEventListener("hax-save",this.saveEvent.bind(this)),super.disconnectedCallback&&super.disconnectedCallback()}static get observedAttributes(){return["element-align","offset-margin","app-store","hide-panel-ops"]}get elementAlign(){return this.getAttribute("element-align")}set elementAlign(e){this.__rendered&&(this.setAttribute("element-align",e),n.elementAlign=e)}get offsetMargin(){return this.getAttribute("offset-margin")}set offsetMargin(e){this.setAttribute("offset-margin",e),this.__rendered&&(n.haxTray.offsetMargin=e)}get hidePanelOps(){return this.getAttribute("hide-panel-ops")}set hidePanelOps(e){e&&(this.setAttribute("hide-panel-ops","hide-panel-ops"),this.__rendered&&(n.haxTray.hidePanelOps=e))}get appStore(){return this.getAttribute("app-store")}set appStore(e){this.setAttribute("app-store",e),this.__rendered&&(n.appStore={...JSON.parse(this.getAttribute("app-store"))})}attributeChangedCallback(n,e,t){}}customElements.define("h-a-x",HAX);export{HAX};